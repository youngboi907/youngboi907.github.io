<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BTCUSDT Delta Candles (5 Min)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    canvas {
      width: 100% !important;
      height: 600px !important;
    }
  </style>
</head>
<body>
  <h2>BTCUSDT Delta Candles (5-Min)</h2>
  <canvas id="deltaChart"></canvas>  <script>
    const maxBars = 288;
    const deltaData = [];
    let lastBarTime = null;
    let openDelta = null;
    let closeDelta = null;
    let highDelta = null;
    let lowDelta = null;
    let cumulativeDelta = 0;

    function roundTo5Min(timestamp) {
      const date = new Date(timestamp);
      date.setSeconds(0, 0);
      date.setMinutes(date.getMinutes() - (date.getMinutes() % 5));
      return date.getTime();
    }

    const ctx = document.getElementById('deltaChart').getContext('2d');
    const deltaChart = new Chart(ctx, {
      type: 'candlestick',
      data: {
        datasets: [{
          label: 'Delta Candles',
          data: deltaData,
          color: {
            up: '#0f0',
            down: '#f00',
            unchanged: '#aaa'
          }
        }]
      },
      options: {
        responsive: true,
        scales: {
          x: {
            ticks: { color: '#ccc' },
            time: {
              unit: 'minute'
            },
            adapters: {
              date: {
                locale: 'en-US'
              }
            },
            type: 'time'
          },
          y: {
            ticks: { color: '#ccc' }
          }
        },
        plugins: {
          legend: { labels: { color: '#fff' } }
        }
      }
    });

    const ws = new WebSocket("wss://fstream.binance.com/ws/btcusdt@trade");
    ws.onmessage = e => {
      const t = JSON.parse(e.data);
      const qty = parseFloat(t.q);
      const price = parseFloat(t.p);
      const isSell = t.m;
      const usd = qty * price;
      const delta = isSell ? -usd : usd;

      const now = Date.now();
      const currentBar = roundTo5Min(now);

      if (!lastBarTime) {
        lastBarTime = currentBar;
        openDelta = delta;
        highDelta = delta;
        lowDelta = delta;
        cumulativeDelta = delta;
        return;
      }

      if (currentBar > lastBarTime) {
        deltaData.push({
          x: new Date(lastBarTime),
          o: parseFloat(openDelta.toFixed(2)),
          h: parseFloat(highDelta.toFixed(2)),
          l: parseFloat(lowDelta.toFixed(2)),
          c: parseFloat(cumulativeDelta.toFixed(2))
        });

        if (deltaData.length > maxBars) deltaData.shift();
        deltaChart.update();

        // Reset for new candle
        lastBarTime = currentBar;
        openDelta = delta;
        highDelta = delta;
        lowDelta = delta;
        cumulativeDelta = delta;
        return;
      }

      cumulativeDelta += delta;
      highDelta = Math.max(highDelta, cumulativeDelta);
      lowDelta = Math.min(lowDelta, cumulativeDelta);
    };
  </script></body>
</html>