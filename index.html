<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BTCUSDT ELR, OI & Long/Short Ratio</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin: 20px 0 10px;
    }
    .chart-box {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 40px;
      background: #222;
      border-radius: 8px;
      padding: 20px;
    }
    canvas {
      width: 100% !important;
      height: 300px !important;
    }
  </style>
</head>
<body>
  <h2>BTCUSDT Estimated Leverage Ratio (ELR)</h2>
  <div class="chart-box">
    <canvas id="elrChart"></canvas>
  </div>
  <h2>BTCUSDT Open Interest (OI)</h2>
  <div class="chart-box">
    <canvas id="oiChart"></canvas>
  </div>
  <h2>BTCUSDT Top Trader Long/Short Ratio</h2>
  <div class="chart-box">
    <canvas id="lsRatioChart"></canvas>
  </div>  <script>
    const maxPoints = 288; // 1 day of 5-min data

    const elrLabels = [], elrData = [];
    const oiLabels = [], oiData = [];
    const lsLabels = [], longRatioData = [], shortRatioData = [];

    const elrChart = new Chart(document.getElementById('elrChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: elrLabels,
        datasets: [{
          label: 'ELR',
          data: elrData,
          borderColor: 'cyan',
          backgroundColor: 'rgba(0,255,255,0.2)',
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { x: { ticks: { color: '#aaa' } }, y: { ticks: { color: '#aaa' } } },
        plugins: { legend: { labels: { color: '#fff' } } }
      }
    });

    const oiChart = new Chart(document.getElementById('oiChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: oiLabels,
        datasets: [{
          label: 'OI',
          data: oiData,
          borderColor: 'orange',
          backgroundColor: 'rgba(255,165,0,0.2)',
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { x: { ticks: { color: '#aaa' } }, y: { ticks: { color: '#aaa' } } },
        plugins: { legend: { labels: { color: '#fff' } } }
      }
    });

    const lsChart = new Chart(document.getElementById('lsRatioChart').getContext('2d'), {
      type: 'line',
      data: {
        labels: lsLabels,
        datasets: [
          {
            label: 'Long Ratio',
            data: longRatioData,
            borderColor: 'green',
            backgroundColor: 'rgba(0,255,0,0.2)',
            fill: true
          },
          {
            label: 'Short Ratio',
            data: shortRatioData,
            borderColor: 'red',
            backgroundColor: 'rgba(255,0,0,0.2)',
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { x: { ticks: { color: '#aaa' } }, y: { ticks: { color: '#aaa' } } },
        plugins: { legend: { labels: { color: '#fff' } } }
      }
    });

    async function fetchMetrics() {
      try {
        const res = await fetch('https://fapi.binance.com/futures/data/globalLongShortAccountRatio?symbol=BTCUSDT&period=5m&limit=1');
        const resOI = await fetch('https://fapi.binance.com/futures/data/openInterestHist?symbol=BTCUSDT&period=5m&limit=1');
        const resELR = await fetch('https://fapi.binance.com/futures/data/estimatedLeverageRatio?symbol=BTCUSDT&period=5m&limit=1');

        const ls = await res.json();
        const oi = await resOI.json();
        const elr = await resELR.json();

        if (ls.length && oi.length && elr.length) {
          const time = new Date(ls[0].timestamp).toLocaleTimeString();
          const longR = parseFloat(ls[0].longAccount);
          const shortR = parseFloat(ls[0].shortAccount);
          const openInterest = parseFloat(oi[0].sumOpenInterest);
          const leverage = parseFloat(elr[0].estimatedLeverageRatio);

          pushData(elrLabels, elrData, time, leverage, elrChart);
          pushData(oiLabels, oiData, time, openInterest, oiChart);
          pushData(lsLabels, longRatioData, time, longR, lsChart);
          pushData(lsLabels, shortRatioData, time, shortR, lsChart);
        }
      } catch (err) {
        console.error('Error fetching metrics:', err);
      }
    }

    function pushData(labelsArr, dataArr, label, value, chart) {
      if (labelsArr.length >= maxPoints) {
        labelsArr.shift();
        dataArr.shift();
      }
      labelsArr.push(label);
      dataArr.push(value);
      chart.update();
    }

    fetchMetrics();
    setInterval(fetchMetrics, 300000); // every 5 min
  </script></body>
</html>