<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BTCUSDT Delta OHLC Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    .chart-container {
      background: #222;
      border-radius: 8px;
      padding: 10px;
      max-width: 1000px;
      margin: auto;
    }
    canvas {
      width: 100% !important;
      height: 600px !important;
    }
  </style>
</head>
<body>
  <h2>BTCUSDT Delta OHLC Candlestick (5-Min)</h2>
  <div class="chart-container">
    <canvas id="deltaChart"></canvas>
  </div>  <script>
    const ctx = document.getElementById("deltaChart").getContext("2d");
    const deltaData = [];
    const maxBars = 288; // 1 day = 288 * 5-min intervals

    const deltaChart = new Chart(ctx, {
      type: 'candlestick',
      data: {
        datasets: [{
          label: 'Delta Candles',
          data: deltaData,
          borderColor: '#fff',
          color: {
            up: 'green',
            down: 'red',
            unchanged: 'gray'
          }
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { labels: { color: '#fff' } }
        },
        scales: {
          x: {
            ticks: { color: '#aaa' },
            time: { unit: 'minute' },
            adapters: { date: { locale: 'en-US' } },
            type: 'time'
          },
          y: {
            ticks: { color: '#aaa' }
          }
        }
      }
    });

    let currentBarTime = null;
    let open = null;
    let high = null;
    let low = null;
    let close = null;

    const ws = new WebSocket("wss://fstream.binance.com/ws/btcusdt@trade");
    ws.onmessage = (e) => {
      const t = JSON.parse(e.data);
      const qty = parseFloat(t.q);
      const price = parseFloat(t.p);
      const isSell = t.m;
      const usd = qty * price;
      const delta = isSell ? -usd : usd;
      const now = Date.now();
      const barTime = roundTo5Min(now);

      if (!currentBarTime) {
        currentBarTime = barTime;
        open = delta;
        high = delta;
        low = delta;
        close = delta;
      }

      if (barTime > currentBarTime) {
        deltaData.push({
          x: new Date(currentBarTime),
          o: open,
          h: high,
          l: low,
          c: close
        });

        if (deltaData.length > maxBars) deltaData.shift();

        deltaChart.update();

        // Reset
        currentBarTime = barTime;
        open = delta;
        high = delta;
        low = delta;
        close = delta;
      } else {
        close = delta;
        if (delta > high) high = delta;
        if (delta < low) low = delta;
      }
    };

    function roundTo5Min(timestamp) {
      const date = new Date(timestamp);
      date.setSeconds(0, 0);
      date.setMinutes(date.getMinutes() - (date.getMinutes() % 5));
      return date.getTime();
    }
  </script></body>
</html>